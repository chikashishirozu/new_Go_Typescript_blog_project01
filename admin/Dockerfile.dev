FROM node:18-alpine

ARG USER_ID=1000
ARG GROUP_ID=1000

# nodeユーザーのUID/GIDを変更
RUN deluser --remove-home node && \
    addgroup -g ${GROUP_ID} node && \
    adduser -D -u ${USER_ID} -G node node

WORKDIR /app

# nodeユーザーで実行
RUN chown -R node:node /app
USER node

COPY --chown=node:node package*.json ./
RUN npm install

COPY --chown=node:node . .

EXPOSE 3001
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "3001"]
